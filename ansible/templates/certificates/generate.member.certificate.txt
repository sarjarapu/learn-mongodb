# Generate the private key file server: {{ item }}.pem
openssl genrsa -out {{ output_dir }}/certs/{{ item }}.key 2048 {{ output_dir }}/certs/{{ item }}.pem
openssl req -new -key {{ output_dir }}/certs/{{ item }}.key -out {{ output_dir }}/certs/{{ item }}.csr -subj "/C=US/ST=Texas/L=Austin/O=MongoDB/OU=Databases/CN={{ item }}"
openssl x509 -req -in {{ output_dir }}/certs/{{ item }}.csr -CA {{ output_dir }}/certs/rootCA.crt -CAkey {{ output_dir }}/certs/rootCA.key -CAcreateserial -out {{ output_dir }}/certs/{{ item }}.crt -days 365
cat {{ output_dir }}/certs/{{ item }}.key {{ output_dir }}/certs/{{ item }}.crt > {{ output_dir }}/certs/{{ item }}.pem
openssl verify -CAfile {{ output_dir }}/certs/rootCA.crt {{ output_dir }}/certs/{{ item }}.pem
# That should return
# server.pem: OK

